function t(t,i){return t*Math.pow(1.059463094359,i)}function i(){if(V)return V=!1,void(N&&gt());N?N=!1:X=!X}function e(t,i,e,n,o){void 0===n&&(n=!1),void 0===o&&(o=1),P.globalCompositeOperation=n?"source-over":"luminosity";var r=[t.width/8,t.height/8],s=[(1-o)*r[0]/2,(1-o)*r[1]/2];P.drawImage(t,(i+s[0])*S,(e+s[1])*S,S*r[0]*o,S*r[1]*o)}function n(t,i){P.globalCompositeOperation="luminosity",K("#999999"),P.fillRect(t*k,i*k,k,k)}function o(t,i){for(var e="#",n=0;n<3;n++){var o=Math.floor(Math.min(parseInt("0x"+t[1+2*n]+t[2+2*n])*i,255));e+=(o<16?"0":"")+o.toString(16)}return e}function r(t){for(var i=et[it[t.length]],e=P.createImageData(i[0],i[1]),n=0;n<e.data.length;n++){var o=Math.floor(n/4),r=16*parseInt(t[o],16);e.data[n]=(n+1)%4==0?0==r?0:255:r}var s=document.createElement("canvas");s.width=i[0]*(i[2]?2:1),s.height=i[1];var a=s.getContext("2d");return i[2]&&(a.putImageData(e,0,0),a.scale(-1,1),a.drawImage(s,-16,0),a.scale(1,1)),a.putImageData(e,0,0),s}function s(t,i){return void 0===i&&(i="56789ABCDEF"),(t+=Y(i)).length<7?s(t,i):t}function a(t,i,e){return Math.min(Math.max(t,i),e)}function h(t,i){P.globalCompositeOperation="source-over",P.globalAlpha=a(i,0,1),K(t),P.fillRect(0,0,1024,1024),P.globalAlpha=1}function f(t,i,e,n){K(t),P.globalCompositeOperation="source-over",P.beginPath(),P.arc(i*S,e*S,n*S,0,2*Math.PI),P.fill()}function c(t){return t*(2-t)}function d(t){return function(){return bt[t].play()}}function u(){d("item1")(),d("item2")()}function l(){d("warp1")(),d("warp2")()}function p(){d("bossHit1")(),d("bossHit2")()}function b(){d("close1")(),d("close2")()}function m(t){J=t,V=!0}function y(){h("#000000",.55),P.fillRect(3.5*S,5.75*S,(I-7)*S,(I-13.75)*S),P.font=S+"px Garamond",K(ui),P.textAlign="left",P.fillText(J.name,4.25*S,7.25*S),P.font=5.5*k+"px Garamond",J.description.forEach(function(t,i){P.fillText(t,4.25*S,(9+i)*S)}),e(J.sprite,I-5.25,6.4,!0),P.fillRect(4.25*S,7.75*S,(I-8.8)*S,.5*k)}function v(){h("#000000",.55),P.fillRect(3.5*S,7.25*S,(I-7)*S,(I-16.9)*S),P.font=S+"px Garamond",K(ui),P.textAlign="center",P.fillText("-     EXIT ACTIVATED     -",I/2*S,(I/2-.9)*S),P.fillRect(4.45*S,7.75*S,(I-8.8)*S,.5*k),P.fillRect(4.45*S,9.75*S,(I-8.8)*S,.5*k)}function x(){Nt=new Wt,requestAnimationFrame(x)}function g(t){void 0===t&&(t=1);var i={x:t*(Vt[39]||Vt[68]||0)-t*(Vt[37]||Vt[65]||Vt[81]||0)+t*Nt.x,y:t*(Vt[40]||Vt[83]||0)-t*(Vt[38]||Vt[87]||Vt[90]||0)+t*Nt.y};return 0!=i.x&&0!=i.y&&(i.x*=.71,i.y*=.71),i}function w(t){var i=T(t);return 0==i?{x:0,y:0}:{x:t.x/i,y:t.y/i}}function T(t){return M(t.x,t.y)}function M(t,i){return Math.sqrt(t*t+i*i)}function E(t,i){var e=[i.x-t.x1,i.y-t.y1],n=t.direction.x*e[0]+t.direction.y*e[1];return n=Math.min(Math.max(n,0),t.length),new zt(t.x1+t.direction.x*n,t.y1+t.direction.y*n,i)}function C(t,i){var e=i.x-t.x,n=i.y-t.y,o=e>0?1:e<0?3:n<0?0:2;t.addDoor(o,i),i.addDoor((o+2)%4,t)}function R(){for(var t=0;t<di.lifeMax;t++)P.globalCompositeOperation="source-over",P.drawImage(Tt[t<di.life?0:1],.25*S+5*k*t,.25*S,4*k,4*k)}function O(){ai.reset(),ii.reset(),di.reset(),hi=[new Qt],j=D=X=!1}function _(){if(G+=.016,requestAnimationFrame(_),ai.update())ai.draw();else{h(ui,1),ii.draw();var t=0;for(ii.update(),di.updateGamepad();!X&&!ii.inTransition&&t<H&&!V&&!N&&!j&&!D;)di.update(),hi.forEach(function(t){t.update(),t.checkHit(di),t.checkHits(ii.activeRoom.ent)}),ii.updateEntities(di),t++;ii.inTransition&&!ii.drawEntities||(hi.forEach(function(t){t.draw()}),di.draw()),V?y():N?v():!X||ii.inTransition||j||D||ii.drawMap(),R(),ni.draw(),oi.draw(),((j=0==di.life)||D)&&(ct.stop(),h("#000000",.5),Q(18),K(ui),j?($("GAME OVER",.5,.5),Q(7),$("[space to continue]",.5,.55)):D&&(Q(10),['"I escaped the',"Hyperdimensional Maze","and all I got was",'this lousy winscreen"'].forEach(function(t,i){$(t,.5,.05*(7+2*i))})),X&&O())}}var A,F=document.getElementById("game"),P=F.getContext("2d"),k=F.width/160,S=8*k,I=20,H=20,L=Math.floor(3.5),B=.5,q=1e-5,j=!1,D=!1,G=0,V=!1,N=!1,X=!1,W=document.addEventListener,Y=function(t){return t[Math.floor(Math.random()*t.length)]},z=function(t){return Math.floor(Math.random()*t)},U=function(t,i){return t+Math.floor(Math.random()*(i-t))},Z=function(t,i){for(var e=t,n=0;n<i-1;n++)t+=e;return t};W("keydown",function(t){32==t.which&&i()}),P.imageSmoothingEnabled=!1;var J,K=function(t){return P.fillStyle=t},Q=function(t){P.font=t*k+"px Palatino",P.textAlign="center"},$=function(t,i,e){return P.fillText(t,I*i*S,I*e*S)},tt=function(t,i){P.globalAlpha=t,i(),P.globalAlpha=1},it={64:0,128:1,2340:2,360:3,224:4,270:5},et=[[8,8,!1],[8,16,!0],[90,26,!1],[45,8,!1],[16,14,!1],[15,18,!1]],nt=function(){function t(t,i,e,n){void 0===i&&(i=t),void 0===e&&(e=t),void 0===n&&(n=!0),this.duration=t,this.durationMin=i,this.durationMax=e,this.autoReset=n,this.reset()}return t.prototype.reset=function(){this.time=G,this.duration=U(this.durationMin,this.durationMax)},Object.defineProperty(t.prototype,"progress",{get:function(){return G-this.time},enumerable:!0,configurable:!0}),t.prototype.check=function(){return this.progress>this.duration&&(this.autoReset&&this.reset(),!0)},Object.defineProperty(t.prototype,"remaining",{get:function(){return this.duration*(1-this.fraction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fraction",{get:function(){return Math.min((G-this.time)/this.duration,1)},enumerable:!0,configurable:!0}),t}(),ot=new(window.AudioContext||window.webkitAudioContext),rt=440,st=[311.13,349.23,392,440,523.25,659.25],at=function(){function i(t,i){this.type=t,this.volume=i}return i.prototype.play=function(i,e){var n=ot.createOscillator(),o=ot.createGain();n.type=this.type,n.start(ot.currentTime),n.connect(o),o.gain.setValueAtTime(q,ot.currentTime),o.connect(ot.destination),n.frequency.setValueAtTime(t(rt,i),ot.currentTime);var r=X?.4:1;o.gain.setValueAtTime(this.volume*B*r,ot.currentTime),o.gain.setValueAtTime(this.volume*B*r,ot.currentTime+2*e/3),o.gain.exponentialRampToValueAtTime(q,ot.currentTime+e),o.connect(ot.destination),n.stop(ot.currentTime+e)},i}(),ht=function(){function t(t,i,e,n,o){void 0===e&&(e=0),void 0===n&&(n="sine"),void 0===o&&(o=1),this.length=t,this.sequence=i,this.rootNote=e,this.instrument=new at(n,o)}return t.prototype.update=function(t,i){if(t%this.length==0){var e=Math.floor(t/this.length)%this.sequence.length,n=this.sequence[e];if("-"!==n&&"_"!==n){for(var o=1;"-"===this.sequence[e+o];)o++;this.instrument.play(this.rootNote+parseInt(n,16),i*this.length*o)}}},t}(),ft=function(){function t(t,i){var e=this;this.bpm=t,this.sequences=i,this.position=0,this.length=0,i.forEach(function(t){e.length=Math.max(e.length,t.sequence.length*t.length)})}return t.prototype.update=function(){var t=this;this.sequences.forEach(function(i){i.update(t.position,60/t.bpm)}),this.position++,this.position%=this.length,this.playing=setTimeout(function(){return t.update()},6e4/this.bpm)},t.prototype.play=function(){var t=this;this.playing=setTimeout(function(){return t.update()},6e4/this.bpm)},t.prototype.stop=function(){clearTimeout(this.playing),this.position=0},t}(),ct=new ft(240,[new ht(2,"0_43--__0_65--__",-12,"square",.15),new ht(1,"ccccccccaaaaffff",-36,"sine"),new ht(1,"777777775555aaaa",-24,"sine",.8),new ht(1,Z("_",96)+"03C--bcbc5-6-3----"+Z("_",14)+"03C--bcbc3-4-0----"+Z("_",14),0,"triangle",.35),new ht(1,Z("_",32)+"03C"+Z("_",29),-12,"sawtooth",.4)]),dt=new ft(240,[new ht(4,"2-__0-__",-36,"triangle",.6),new ht(2,"c7c7c7c7a5a5a5a5",-24,"sine",.3),new ht(1,Z("_",32)+"____237---__________230---______",12,"square",.1)]),ut=1,lt=function(){function t(t,i,e){this.duration=i,this.gainEnvelope=e;var n=ot.sampleRate/t;this.node=ot.createBufferSource();for(var o=ot.createBuffer(1,n,ot.sampleRate),r=o.getChannelData(0),s=0;s<n;s++)r[s]=Math.random();this.node.buffer=o,this.node.loop=!0,this.gain=ot.createGain(),this.node.start(ot.currentTime),this.node.connect(this.gain),this.gain.gain.setValueAtTime(q,ot.currentTime),this.gain.connect(ot.destination)}return t.prototype.play=function(){this.gain.gain.setValueAtTime(ut,ot.currentTime);for(var t=0;t<this.gainEnvelope.length;t++)this.gain.gain.exponentialRampToValueAtTime(this.gainEnvelope[t][0]*ut,ot.currentTime+this.duration*this.gainEnvelope[t][1]);this.gain.gain.exponentialRampToValueAtTime(q,ot.currentTime+this.duration)},t}(),pt=function(){function i(t,i,e,n,o,r){void 0===o&&(o=440),void 0===r&&(r=!0),this.duration=i,this.frequencyEnvelope=e,this.gainEnvelope=n,this.baseFreq=o,this.bend=r,this.osc,this.osc=ot.createOscillator(),this.gain=ot.createGain(),this.osc.type=t,this.osc.start(ot.currentTime),this.osc.connect(this.gain),this.gain.gain.setValueAtTime(q,ot.currentTime),this.gain.connect(ot.destination)}return i.prototype.play=function(){this.osc.frequency.setValueAtTime(t(this.baseFreq,this.frequencyEnvelope[0][0]),ot.currentTime);for(i=0;i<this.frequencyEnvelope.length;i++)this.bend?this.osc.frequency.exponentialRampToValueAtTime(t(this.baseFreq,this.frequencyEnvelope[i][0]),ot.currentTime+this.duration*this.frequencyEnvelope[i][1]):this.osc.frequency.setValueAtTime(t(this.baseFreq,this.frequencyEnvelope[i][0]),ot.currentTime+this.duration*this.frequencyEnvelope[i][1]);this.gain.gain.setValueAtTime(ut,ot.currentTime);for(var i=0;i<this.gainEnvelope.length;i++)this.gain.gain.exponentialRampToValueAtTime(this.gainEnvelope[i][0]*ut,ot.currentTime+this.duration*this.gainEnvelope[i][1]);this.gain.gain.exponentialRampToValueAtTime(q,ot.currentTime+this.duration)},i}(),bt={ballBomp:new pt("triangle",.7,[[0,0],[12,.2],[0,.4],[12,.6],[0,.8],[12,1]],[[1,0]],240),laserHit:new pt("sawtooth",.2,[[0,0]],[[.1,0],[.1,.7],[1,.8]],540),bulletHit:new pt("square",.2,[[0,0]],[[1,0]],540),monsterHit:new pt("square",.5,[[0,0],[24,.3],[0,.8]],[[1,0]],30),artyDrop:new pt("sine",1,[[12,0],[24,.2],[12,.35],[24,.5]],[[.5,0],[1,.5],[1,.6]],440,!1),item1:new pt("sine",.2,[[12,0],[12,.49],[24,.5],[24,1]],[[1,0],[.01,.49],[1,.5]],440),item2:new pt("sine",.2,[[19,0],[19,.49],[31,.5],[31,1]],[[1,0],[.01,.49],[1,.5]],440),warp1:new pt("square",2,[[0,0],[7,.25],[12,.5]],[[1,0],[.01,.24],[1,.25],[.01,.49],[1,.5],[1,.55]],40),warp2:new pt("sawtooth",1.5,[[24,0],[31,.33],[36,.66]],[[1,0],[.01,.32],[1,.33],[.01,.65],[1,.66]],40),bossHit1:new pt("square",1,[[12,0]],[[1,0],[.3,.5]],50),bossHit2:new pt("sawtooth",1,[[48,0],[0,1]],[[1,0],[.3,.5]],50),close1:new lt(60,.1,[[1,0],[1,.9]]),close2:new lt(30,.4,[[1,0],[.5,.3],[.5,.8]]),playerHit:new lt(440,.4,[[1,0],[.5,.5]])},mt=d("ballBomp"),yt=d("laserHit"),vt=d("bulletHit"),xt=d("monsterHit"),gt=d("artyDrop"),wt=d("playerHit"),Tt=[r("007007000bfbbfb0bffbfff7bffffff70bffff7000bff700000b700000000000"),r("00b00b000b0bb0b0b00b000bb000000b0b0000b000b00b00000bb00000000000")],Mt=[r("000dd00000dffd0000fddf000dffffd00fffffb000bddb0000ffff0000f00f00"),r("000dd00000dffd0000fddf000dffffd00fffffb000bddb0000ffff0000b00f00"),r("000dd00000dffd0000fddf000dffffd00bfffff000bddb0000ffff0000f00b00")],Et=r("00b00d000d0000f0db0000dfd70bf07fd70bb07fdb0000bd0d0000d000b00b00"),Ct=r("0000000000000000000bb00000bddb0000bddb00000bb0000000000000000000"),Rt=[r("000000000db00bd000dddd000d7dd7d00bdbbdb00dd77dd00db00bd000000000"),r("00000000000000000d0000d00bddddb00d7dd7d00bddddb00dd77dd000000000")],Ot=[r("0dddddd0dbbbbbb7dbbbbbb7dbbbbbb7dbbbbbb7dbbbbbb7dbbbbbb707777770"),r("0dddddd0dbbbbbb7dbbbb7b7db7bbbb7dbbbbbb7dbbb7bb7dbbbbbb707777770"),r("0dddddd0db7bdbb7ddbbb7b7db7bbbb7dbbbdb77d7bb7bb7db7bbbb707777770")],_t=r("000000000ddddddfdffffffbbffffff309fbbfbf0bf00f000df0000000000000"),At=[r("0000000000000000000000000000000000000000000000000000000000000000000000000000000ffd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffdb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000ddddb0000000000000000000000000000000000000000000000000000000000000000000000000000000000007fffdb7700000000000000000000000000000000000000000000000000000000000000000000000000000000007fffdb77700000000000000000000000000000000000000000000000000000000000000000000000000000000bbdfffffd70000000000000000000000000555555555555555555555555555555555555555bddb55500000000bbdfffffffd000000000000000000555555555555555555555555555555555555555555555bdffdb5ffffffffffffffffffffdff0bbbb0bbbb00bbbbbb0bbbbbbbbbbdbbdbdddddddddfffffffffffffffffffddfbf5ddfddfddfddfddfddffdddf000000000bbbbbbbbbbbb0bbbb0bbbbbbbbbbbbbbbbbbbbbbbbbbbdbdffffddfbf55bbbbbbbbbbbdbbdbbfdbbf00000000000000000555555555555555555555555555555555555555555bdffdb5ddbbbbbddbbbbdbbdbbfdbb0000000000000000000000555555555555555555555555555555555555555bddb555000000ddd099999ffdfd00000000000000000000000000000000000000000000000000000000000000000000000000000000bb999fffd000000000000000000000000000000000000000000000000000000000000000000000000000000000bbb999770000000000000000000000000000000000000000000000000000000000000000000000000000000000bbb99970000000000000000000000000000000000000000000000000000000000000000000000000000000000bbb99990000000000000000000000000000000000000000000000000000000000000000000000000000000000bbb999970000000000000000000000000000000000000000000000000000000000000000000000000000000000b9779977000000000000000000000000000000000000000000000000000000000000000000000000000000000bb770b977000000000000000000000000000000000000000000000000000000000000000000000000000000000b7700b777000000000000000000000000000000000000000000000000000000000000000000000000000000000b77000b777000000000000000000000000000000000000000000000000000000000000000000000000000000000770000b777000000000000000000000000000000000000000000000000000000000000000000000000000000007770000b770000000000000000000000000000000000000000000000000000000000000000000000000000000007700000b70000000000000000000000000000000000000000000000000000000000000000000000000000000007700000b7000000000000000000000000000000000000000000000000000000000000000000000000000000007770000b7700000"),r("00000055555555bbbbbb5555555505000000000000000000055599999bbbddddbbb999995555050000000000000055599999bddddddddddddb999995550000000000000055555599999bbbddddbbb999995555555000050500005055555555999bbbbbbbb999555555000505000505050050505555555999999999955555550000050500000505000005055555555555555555505000000000000000000000000005050555555550505050000000000000000000"),r("00900000000009000059000000009500005900000000950007339000000933700753500000055370073537999975357005335353535353507333353535353337733333333333333773333333333333375333333333333335533333333333333550333033303330355303030303030305"),r("000009000000000000079000000000000539000000000003539000000000005337000000090005337000000590005353990005390053335359905390053333535373390053333353533370533333333335370533333333333539530333333333359003033333333537000003033333357000000303333537000000003033355000000000003035")],Ft=[r("dddddddd55555555555bb555b5b77b5bb5b77b5b555bb55555555555dddddddd"),r("d55bb55dd555555dd55bb55dd5b77b5dd5b77b5dd55bb55dd555555dd55bb55d")],Pt=[r("7777777779999997797777977979979779799797797777977999999777777777"),r("9999999997777779979999799797797997977979979999799777777999999999")],kt=r("fd0000dfd000000d000ff00000f33f0000f33f00000ff000d000000dfd0000df"),St=[r("00999900090df090900f0f09900f0f09900fb00990df000909fd009000999900"),r("00ffff000f0790f0f0f9090ff00f090ff009f00ff0790f0f0f9700f000ffff00"),r("0ff000fff000000f0f0ff000f00f0000000ff000000f0f0ff00000f0ff000f0f"),r("f99000999f00000909f99000900f00000009f00000090f09900000f09900090f")],It=r("0000000000d0f0000d9fff0000d9f0000b000f000b000f0000bbf00000000000"),Ht=r("00000000000007770007797900799bbb079b9b7779bbb75b779bb33d79bbbb33779bbbbb79bbbbbb79b9bbdb079bd0d0079bdd000079bdd00007700000000000"),Lt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Bt=function(){function t(t,i){this.x=t,this.y=i,this.description=[]}return t.prototype.at=function(t,i){return this.x==t&&this.y==i},t.prototype.got=function(t){},t}(),qt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.sprite=Et,i.name="SHIELD GENERATOR",i.description=["This small generator produces a","shield that can absorb enemy attacks.","Move around to charge it up!"],i}return Lt(i,t),i.prototype.got=function(t){t.hasShield=!0,t.shieldSteps=0},i}(Bt),jt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.sprite=It,i.name="GEMINI RING",i.description=["This ring splits the hyperdimensional","sphere into a smaller and faster pair.","Wild times ahead!"],i}return Lt(i,t),i.prototype.got=function(t){A()},i}(Bt),Dt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.sprite=_t,i.name="HYPER CANNON",i.description=["This powerful cannon has twice as","many dimensions as your old one.","Come get some!"],i}return Lt(i,t),i.prototype.got=function(t){t.hasCannon=!0},i}(Bt),Gt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.sprite=Tt[0],i}return Lt(i,t),i.prototype.got=function(t){t.life++},i}(Bt),Vt={};W("keydown",function(t){Vt[t.which]=!0}),W("keyup",function(t){delete Vt[t.which]});var Nt,Xt=performance.now(),Wt=function(){return function(){this.x=0,this.y=0,this.right={x:0,y:0},this.pause=!1;for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],e=0;e<t.length;e++)if(null!=t[e]&&"Xbox 360"==t[e].id.substr(0,8)){var n=function(i){return Math.abs(t[e].axes[i])>.2?t[e].axes[i]:0};this.x+=n(0),this.y+=n(1),this.right.x+=n(2),this.right.y+=n(3),this.pause|=(t[e].buttons[9].pressed||t[e].buttons[0].pressed)&&performance.now()-Xt>200}this.pause&&(Xt=performance.now(),i())}}();x();var Yt=function(){function t(t,i,e,n){this.x1=t,this.y1=i,this.x2=e,this.y2=n}return Object.defineProperty(t.prototype,"length",{get:function(){return M(this.x2-this.x1,this.y2-this.y1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return{x:(this.x2-this.x1)/this.length,y:(this.y2-this.y1)/this.length}},enumerable:!0,configurable:!0}),t.prototype.capped=function(i){return this.length<i?this:new t(this.x1,this.y1,this.x1+this.direction.x*i,this.y1+this.direction.y*i)},t.prototype.rot90=function(){return new t(this.x1,this.y1,this.x1+(this.y2-this.y1),this.y1-(this.x2-this.x1))},t.prototype.rot180=function(){return new t(this.x1,this.y1,this.x1-(this.x2-this.x1),this.y1-(this.y2-this.y1))},t.prototype.rot270=function(){return this.rot90().rot180()},t}(),zt=function(){return function(t,i,e){this.x=t,this.y=i;var n=e.x-t,o=e.y-i;this.distance=M(n,o),this.direction={x:0,y:0},0!==this.distance&&(this.direction={x:n/this.distance,y:o/this.distance})}}(),Lt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Ut=function(){function t(){this.width=.4,this.x=I/2,this.y=I/2,this.velocity={x:0,y:0},this.isBall=!1,this.imageList=Rt,this.fps=1.2,this.frameOffset=Math.random(),this.dying=!1,this.aiTi=new nt(.5,.5,1),this.maxSpeed=.05,this.shotTi=new nt(2.5,1.5,3.5)}return Object.defineProperty(t.prototype,"speed",{get:function(){return T(this.velocity)},set:function(t){var i=this.speed;this.velocity.x*=t/i,this.velocity.y*=t/i},enumerable:!0,configurable:!0}),t.prototype.refreshTis=function(){this.aiTi.reset(),this.shotTi.reset()},t.prototype.update=function(){this.aiTi.check()&&this.randomizeVelocity(),this.tryMove(this.velocity.x/H,this.velocity.y/H)},t.prototype.shooting=function(t){return this.shotTi.check()?[new Zt(t,this)]:[]},t.prototype.draw=function(){e(this.imageList[Math.floor((G*this.fps+this.frameOffset)%1*this.imageList.length)],this.x-.5,this.y-.5)},t.prototype.tryMove=function(t,i){var e=this.x+t,n=this.y,o=ii.activeRoom.outOfBounds(e,n,this.width/2);~o?this.onOutOfBounds(o):(ii.activeRoom.collides(e,n,this.width/2,this)?(this.onHitWall(!0),e=this.x):this.x=e,n=this.y+i,~(o=ii.activeRoom.outOfBounds(e,n,this.width/2))?this.onOutOfBounds(o):ii.activeRoom.collides(e,n,this.width/2,this)?this.onHitWall(!1):this.y=n)},t.prototype.randomizeVelocity=function(){this.velocity.x=Math.random()-.5,this.velocity.y=Math.random()-.5,this.speed=this.maxSpeed},t.prototype.onOutOfBounds=function(t){this.onHitWall(t%2==1)},t.prototype.onHitWall=function(t){t?this.velocity.x*=-1:this.velocity.y*=-1},t.prototype.onHitByBall=function(){this.dying=!0,xt()},t.prototype.onHitPlayer=function(t){},t}(),Zt=function(t){function i(i,e){var n=t.call(this)||this;return n.aliveFor=0,n.width=.15,n.imageList=[Ct],n.velocity.x=i.x-e.x,n.velocity.y=i.y-e.y,n.maxSpeed=.15,n.speed=n.maxSpeed,n.baseX=e.x,n.baseY=e.y,n.onHitByBall=n.onHitWall=n.onOutOfBounds=n.onHitPlayer=n.die,n}return Lt(i,t),Object.defineProperty(i.prototype,"x",{get:function(){return this.baseX+this.getOffsetX()},set:function(t){this.baseX=t-this.getOffsetX()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.baseY+this.getOffsetY()},set:function(t){this.baseY=t-this.getOffsetY()},enumerable:!0,configurable:!0}),i.prototype.getOffsetX=function(){return 0},i.prototype.getOffsetY=function(){return 0},i.prototype.update=function(){this.aliveFor+=.016/H,this.tryMove(this.velocity.x/H,this.velocity.y/H)},i.prototype.die=function(){this.dying=!0},i.prototype.shooting=function(){return[]},i}(Ut),Jt=function(){function t(){this.members=new Array}return t.prototype.addMember=function(t){return-1===this.members.indexOf(t)&&this.members.push(t),t},t.prototype.removeMember=function(t){-1!==this.members.indexOf(t)&&this.members.slice(this.members.indexOf(t))},t.prototype.update=function(t,i){var e=this;this.members.forEach(function(t){return t.update()}),this.members.forEach(function(i){i.dying&&i instanceof Kt&&t.dropArtifact(i)}),this.members=this.members.filter(function(t){return!t.dying}),this.members.forEach(function(t){if(t.shooting(i).forEach(function(t){e.addMember(t)}),t instanceof Zt){var n=new zt(t.x,t.y,i);n.distance<t.width/2+i.width/2&&(n.direction=t.velocity,t.onHitPlayer(n),i.onHitPlayer(n))}})},t.prototype.draw=function(){this.members.forEach(function(t){t.draw()})},t}(),Kt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.width=.8,i.imageList=[Ht],i.maxSpeed=.025,i.life=4,i}return Lt(i,t),i.prototype.draw=function(){e(this.imageList[Math.floor((G*this.fps+this.frameOffset)%1*this.imageList.length)],this.x-1,this.y-1)},i.prototype.randomizeVelocity=function(){this.velocity.x=Math.random()-.5,this.velocity.y=Math.random()-.5,this.speed=this.maxSpeed},i.prototype.onHitByBall=function(){this.life--,p(),this.life<=0&&(this.dying=!0)},i.prototype.shooting=function(t){var i=[];if(this.shotTi.check()){var e=w({x:t.x-this.x,y:t.y-this.y});i.push(this.makeBullet(t,e,2)),i.push(this.makeBullet(t,e,0)),i.push(this.makeBullet(t,e,-2))}return i},i.prototype.makeBullet=function(t,i,e){var n={x:t.x+i.y*e,y:t.y-i.x*e},o=new Zt(n,this);return o.getOffsetX=function(){return-Math.sin(5*o.aliveFor)*w(o.velocity).y},o.getOffsetY=function(){return Math.sin(5*o.aliveFor)*w(o.velocity).x},o},i}(Ut),Qt=function(t){function i(){var i=t.call(this)||this;return i.currentColor="#FFFFFF",i.isBall=!0,i.maxSpeed=.15,i.randomizeVelocity(),i}return Lt(i,t),Object.defineProperty(i.prototype,"activated",{get:function(){return ii.activeRoom.cleared},enumerable:!0,configurable:!0}),i.prototype.onHitWall=function(i){t.prototype.onHitWall.call(this,i),mt()},i.prototype.update=function(){if(this.tryMove(this.velocity.x/H,this.velocity.y/H),this.speed>this.maxSpeed){var t=.1/H;this.speed=this.speed*(1-t)+this.maxSpeed*t}this.currentColor=this.activated?s("#","89abcd"):"#FFFFFF"},i.prototype.onOutOfBounds=function(t){this.activated?(ii.teleport(t,this.currentColor),l()):this.onHitWall(t%2!=0)},i.prototype.checkHit=function(t){var i=this;t.lasing&&t.laserTo.forEach(function(t){i.evaluateCollision(E(t,{x:i.x,y:i.y}),i.width)&&yt()})},i.prototype.evaluateCollision=function(t,i){var e=i-t.distance;if(e>0){var n=this.velocity.x*t.direction.x+this.velocity.y*t.direction.y;n<0&&(this.velocity.x-=2*n*t.direction.x,this.velocity.y-=2*n*t.direction.y);var o=t.direction.x*e,r=t.direction.y*e;return this.velocity.x+=o,this.velocity.y+=r,this.tryMove(o,r),!0}return!1},i.prototype.checkHits=function(t){var i=this;t.members.forEach(function(t){i.evaluateCollision(new zt(t.x,t.y,i),i.width+t.width)&&(t.onHitByBall(),t instanceof Zt&&vt())})},i.prototype.draw=function(){f(ii.inTransition?ii.nextColor:this.currentColor,this.x,this.y,.8*this.width),ii.inTransition&&(P.lineWidth=10,P.strokeStyle=ii.nextColor,P.beginPath(),P.arc(this.x*S,this.y*S,.8*this.width*S*30*c(ii.warpTi.progress/.5),0,2*Math.PI),P.stroke())},i}(Ut),Lt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),$t=function(){function t(t,i){var e=this;this.x=t,this.y=i,this.walls=Array(I*I),this.exits=Array(4),this.its={},this.artifact=void 0,this.explored=!1,this.spotted=!1,this.ent=new Jt,this.exitRoom=!1,this.exitOpened=!1,this.exitRoomTi=new nt(20,20,20,!1),this.exitRoomSpawnTi=new nt(1,.5,1.5);for(var i=0;i<I;i++)for(var t=0;t<I;t++){var n=0==i||i==I-1||0==t||t==I-1;this.walls[i*I+t]=n?1:0}this.exits.forEach(function(t,i){t&&e.addDoor(i,t)}),this.numConnections=Y([1,1,1,1,2,2,2,3])}return Object.defineProperty(t.prototype,"validConnections",{get:function(){return[0!=this.y,6!=this.x,6!=this.y,0!=this.x]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numValidConnections",{get:function(){var t=this.validConnections;return 1*+t[0]+1*+t[1]+1*+t[2]+1*+t[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trapRoom",{get:function(){return 1==this.exits.filter(function(t){return void 0!==t}).length||this.exitRoom||void 0!=this.artifact},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cleared",{get:function(){return 0===this.ent.members.length},enumerable:!0,configurable:!0}),t.prototype.getGrowthDir=function(){for(var t=Math.floor(4*Math.random());!this.validConnections[t];)t=Math.floor(4*Math.random());return[0,1,2,3][t]},t.prototype.addDoor=function(t,i){this.freeDoor(t,!0),this.exits[t]=i},t.prototype.freeDoor=function(t,i){if(void 0===i&&(i=!1),0==t||2==t)this.walls.splice(t?I*I-12:8,4,0,0,0,0),i&&this.walls.splice(t?I*I-11-3*I:9+3*I,2,4,4);else for(var e=0;e<4;e++){var n=I*(8+e)+(1==t?I-1:0);this.walls[n]=0,i&&(this.walls[n+3*(1==t?-1:1)]=0==e||3==e?0:4)}},t.prototype.blockDoor=function(t){if(this.exits[t])if(0==t||2==t)this.walls.splice(t?I*I-12:8,4,5,5,5,5);else for(var i=0;i<4;i++){var e=I*(8+i)+(1==t?I-1:0);this.walls[e]=6}},t.prototype.setAsExitRoom=function(){for(var t=this,i=1;i<I-1;i++)for(var e=1;e<I-1;e++)this.walls[i*I+e]=0;this.its={},this.exitRoom=!0,[[9,9,7],[9,10,7],[10,9,7],[10,10,7],[9,8,4],[10,8,4],[9,11,4],[10,11,4],[8,9,4],[8,10,4],[11,9,4],[11,10,4],[8,7,5],[9,7,5],[10,7,5],[11,7,5],[8,12,5],[9,12,5],[10,12,5],[11,12,5],[7,8,6],[7,9,6],[7,10,6],[7,11,6],[12,8,6],[12,9,6],[12,10,6],[12,11,6]].forEach(function(i){t.walls[t.index(i[0],i[1])]=i[2]}),this.ent=new Jt;for(var n=0;n<6;n++)this.addExitMonster()},t.prototype.addExitMonster=function(){var t=Y([[2,2],[18,18],[2,18],[18,2]]),i=this.ent.addMember(Math.random()>.1?new Ut:new Kt);i.x=t[0],i.y=t[1]},t.prototype.generateBlocks=function(){var t=this,i=Y([[[6,6],[13,6],[6,13],[13,13]],[[5,10],[6,9],[7,10],[12,9],[13,10],[14,9]],[[1,7],[2,7],[3,7],[4,7],[5,7],[18,12],[17,12],[16,12],[15,12],[14,12]],[[3,3],[4,4],[16,3],[15,4],[3,16],[4,15],[16,16],[15,15]]]);i.forEach(function(i){t.walls[t.index(i[0],i[1])]=4});for(var e=Math.min(z(2*i.length/3),Math.floor(i.length/4));e>0;){var n=Y(i);this.its[this.index(n[0],n[1])]=new Gt(this.x,this.y),i.splice(i.indexOf(n),1),e--}},t.prototype.generateMonsters=function(){for(var t=this.artifact?1:U(3,6)+(this.trapRoom?4:0);t>0;){var i=U(2,I-2),e=U(2,I-2),n=this.artifact?new Kt:new Ut;this.collides(i,e,n.width/2,n)||(this.ent.addMember(n),n.x=i,n.y=e,t--)}},t.prototype.dropArtifact=function(t){this.artifact&&(gt(),this.its[this.index(t.x,t.y)]=this.artifact)},t.prototype.draw=function(t,i,n){var o=this;void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=!0),this.walls.forEach(function(r,s){var a=s%I,h=Math.floor(s/I);r?r>4&&r<7?e(Ft[r-5],a+t,h+i):7===r?e(Pt[0+Math.floor((4*G+a+h)%2)],a+t,h+i):e(1==r?Ot[0]:Ot[4-r],a+t,h+i):n&&s in o.its&&e(o.its[s].sprite,a,h,!0)}),!this.exitRoom||this.exitOpened||ii.inTransition||(Q(14),K("#FFFFFF"),$(""+Math.floor(this.exitRoomTi.remaining),.5,.225))},t.prototype.update=function(t){var i=this;if(this.exitRoom&&(this.exitRoomSpawnTi.check()&&this.addExitMonster(),!this.exitOpened&&this.exitRoomTi.check())){this.walls.forEach(function(t,e){5!=t&&6!=t||(i.walls[e]=0)});for(e=0;e<4;e++)this.blockDoor(e);this.exitOpened=!0}if(this.ent.update(this,t),0==this.ent.members.length&&this.trapRoom)for(var e=0;e<4;e++)this.exits[e]&&this.freeDoor(e)},t.prototype.onEnter=function(){if(this.exitRoomTi.reset(),this.exitRoomSpawnTi.reset(),this.trapRoom)for(var t=0;t<4;t++)this.blockDoor(t),b()},t.prototype.outOfBounds=function(t,i,e){return i-e<0?0:t+e>I?1:i+e>I?2:t-e<0?3:-1},t.prototype.blocks=function(t,i){return 0!==this.at(t,i)},t.prototype.at=function(t,i){return this.walls[this.index(t,i)]},t.prototype.index=function(t,i){return Math.floor(i)*I+Math.floor(t)},t.prototype.touchesIt=function(t){for(var i=t.x,e=t.y,n=t.width/2,o=-n;o<=n;o+=2*n)for(var r=-n;r<=n;r+=2*n){var s=this.index(i+o,e+r);if(s in this.its){var a=this.its[s];a instanceof Gt||(m(a),this.manager.acquireIt(a)),delete this.its[s],u(),a.got(t)}}},t.prototype.collides=function(t,i,e,n){for(var o=n instanceof Qt,r=-e;r<=e;r+=2*e)for(var s=-e;s<=e;s+=2*e){var a=this.index(t+r,i+s);if(this.blocks(t+r,i+s))return o&&2==this.walls[a]?this.walls[a]=0:o&&this.walls[a]>2&&this.walls[a]<5?this.walls[a]--:7==this.walls[a]&&n instanceof ci&&(D=!0),!0}return!1},t}(),ti=function(t){function i(i,e){var n=t.call(this,i,e)||this;return n.numConnections=0,n}return Lt(i,t),i}($t),ii=new(function(){function t(){this.rooms=[],this.transitionTi=new nt(1),this.warpTi=new nt(1.75),this.inTransition=!1,this.warping=!1,this.vx=0,this.vy=0,this.dir=0,this.map=[],this.af=[],this.drawEntities=!0,this.lastRootChord=rt,this.nextRootChord=rt,this.reset()}return Object.defineProperty(t.prototype,"activeRoom",{get:function(){return this._activeRoom},set:function(t){t.explored=!0,t.spotted=!0,t.exits.forEach(function(t){t&&(t.spotted=!0)}),this._activeRoom=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.generateArtifacts(),this.clearMap();var t=Math.floor(3.5),i=t;this.add(t,i),this.map[t][i].numConnections++,this.spawnMap(),this.activeRoom=this.map[t][i],this.activeRoom.ent=new Jt},t.prototype.generateArtifacts=function(){this.af=[new qt(z(7),z(Math.floor(7/4))),new Dt(z(Math.floor(7/3)),U(Math.floor(14/3),7)),new jt(U(Math.floor(14/3),7),U(Math.floor(14/3),7))]},t.prototype.add=function(t,i){this.map[t][i]=new $t(t,i),this.map[t][i].manager=this,this.rooms.push(this.map[t][i])},t.prototype.onTransitionEnd=function(t,i){},t.prototype.update=function(){return!!this.inTransition&&(this.nextRoom&&1===this.transitionTi.fraction?(this.activeRoom=this.nextRoom,this.activeRoom.ent.members.forEach(function(t){return t.refreshTis()}),this.nextRoom=void 0,this.inTransition=!1,this.onTransitionEnd(this.dir,!0),this.activeRoom.onEnter()):this.nextRoom||1!==this.warpTi.fraction||(this.inTransition=!1,this.onTransitionEnd(this.dir,!0),this.activeRoom.onEnter()),rt=this.lastRootChord*(1-this.warpTi.fraction)+this.nextRootChord*this.warpTi.fraction,!0)},t.prototype.updateEntities=function(t){this.activeRoom.update(t)},t.prototype.draw=function(){if(this.inTransition&&this.nextRoom){var t=this.transitionTi.fraction;this.activeRoom.draw(this.vx*t*I,this.vy*t*I,!1),this.nextRoom.draw(this.vx*(t-1)*I,this.vy*(t-1)*I,!1)}else if(this.inTransition){var i=this.warpTi.progress;if(this.activeRoom.draw(),this.drawEntities=i<.5,i>.5){this.warping&&(this.spawnDimension(),this.warping=!1),h(this.lastColor,1-this.warpTi.fraction),Q(12);var e="DIMENSION WARP";K(o("#FFFFFF",this.warpTi.fraction));for(var n=0;n<e.length;n++)P.fillText(e.substr(n,1),I*S/5+S*(n+.15*Math.random()),I*S/2+S*(Math.random()-.25))}this.drawEntities&&this.activeRoom.ent.draw(),h("#FFFFFF",i<.5?0:1-(i-.5)/.5)}else this.activeRoom.draw(),this.activeRoom.ent.draw()},t.prototype.drawMap=function(){var t=this;h("#000000",.55),P.fillRect(4*S,3*S,(I-8)*S,(I-6)*S),Q(14),K(ui),P.fillText("-  M  A  P  -",I*S/2,I*S/4+1*k);for(var i=(I-10)*S/7,e=0;e<7;e++)for(n=0;n<7;n++)K("#252525"),P.fillRect(5*S+i*n,6*S+i*e,i-k,i-k);this.rooms.forEach(function(t){if(t.explored){var e=t.exits;K(t.explored?ui:o(ui,.5));for(var n=0;n<4;n++)if(e[n]){var r=(t.x+e[n].x)/2,s=(t.y+e[n].y)/2;P.fillRect(5*S+i*(r+.35)-k/2,6*S+i*(s+.35)-k/2,.3*i,.3*i)}}}),this.rooms.forEach(function(e){e.spotted&&(K(e.explored?ui:o(ui,.5)),P.fillRect(5*S+i*e.x,6*S+i*e.y,i-k,i-k),e==t.activeRoom&&G%1>.5&&(K("#FFFFFF"),P.fillRect(5*S+i*(e.x+.25),6*S+i*(e.y+.25),.5*i-k,.5*i-k)))});for(e=0;e<7;e++)for(var n=0;n<7;n++)this.af.forEach(function(t){t.at(n,e)&&P.drawImage(t.sprite,5*S+i*(n+.1),6*S+i*(e+.1),.8*i-k,.8*i-k)}),0===this.af.length&&n===L&&e===L&&P.drawImage(kt,5*S+i*(n+.1),6*S+i*(e+.1),.8*i-k,.8*i-k)},t.prototype.transition=function(t){this.dir=t,this.inTransition=!0,this.drawEntities=!1,this.vx=[0,-1,0,1][t],this.vy=[1,0,-1,0][t],this.nextRoom=this.activeRoom.exits[t],this.transitionTi.reset()},t.prototype.teleport=function(t,i){this.dir=t,this.drawEntities=!0,this.nextColor=i,this.warping=!0,this.warpTi.reset(),this.inTransition=!0;for(var e=0,n=0;n<3;n++)e+=parseInt(i[2*n+1],16)/3;this.lastRootChord=rt,this.nextRootChord=st[Math.floor(e-8)]},t.prototype.spawnDimension=function(){this.lastColor=ui,ui=o(this.nextColor,.8),this.clearMap(),this.add(this.activeRoom.x,this.activeRoom.y),this.grow(this.rooms[0],this.dir),this.spawnMap(),this.activeRoom=this.rooms[1]},t.prototype.checkForExit=function(){0===this.af.length&&this.rooms.forEach(function(t,i){t.x==L&&t.y==L&&t.setAsExitRoom()})},Object.defineProperty(t.prototype,"availableConnections",{get:function(){var t=0;return this.rooms.forEach(function(i){t+=i.numConnections}),t},enumerable:!0,configurable:!0}),t.prototype.grow=function(t,i){var e=[0,1,0,-1][i],n=[-1,0,1,0][i];e+=t.x,n+=t.y,this.hasAt(e,n)||this.add(e,n),C(t,this.map[e][n])},t.prototype.hasAt=function(t,i){return!(this.map[t][i]instanceof ti)},t.prototype.spawnMap=function(){for(var t=this;this.availableConnections>0;)this.rooms.forEach(function(i){if(i.numConnections>0){var e=i.getGrowthDir();i.numConnections--;var n=[0,1,0,-1][e],o=[-1,0,1,0][e];(!t.hasAt(i.x+n,i.y+o)||Math.random()<.5)&&t.grow(i,e)}});this.rooms.forEach(function(i){i.generateBlocks(),t.af.forEach(function(t){t.at(i.x,i.y)&&(i.artifact=t)}),i.generateMonsters()}),this.checkForExit()},t.prototype.acquireIt=function(t){var i=this.af.indexOf(t);-1!==i&&(this.af.splice(i,1),this.checkForExit(),0==this.af.length&&(N=!0))},t.prototype.clearMap=function(){this.rooms=[],this.map=[];for(var t=0;t<7;t++){this.map[t]=[];for(var i=0;i<7;i++)this.map[t].push(new ti(i,t))}},t}()),ei=function(){function t(t,i){var e=this;this.x=t,this.rootFrame=i,this.activeFrame=0,this.activeFrame=i,W("click",function(t){var i=F.getBoundingClientRect(),n=(t.clientX-i.left)/i.width*I,o=(t.clientY-i.top)/i.width*I;n>e.x&&n<e.x+1&&o<1&&e.toggle()})}return t.prototype.toggle=function(){this.activeFrame===this.rootFrame?(this.activeFrame=this.rootFrame+1,this.off()):(this.activeFrame=this.rootFrame,this.on())},t.prototype.draw=function(){e(St[this.activeFrame],this.x,0,!0,.7)},t.prototype.off=function(){},t.prototype.on=function(){},t}(),ni=new ei(I-2,0);ni.off=function(){return B=.001},ni.on=function(){return B=.5};var oi=new ei(I-1,2);oi.on=function(){return ut=1},oi.off=function(){return ut=.001};var ri="00111223",si=performance.now(),ai=new(function(){function t(){this.backgroundTransition=new nt(6),this.currentColor=s("#",ri),this.nextColor=s("#",ri),this.room=new ti(0,0),this.reset(),this.info=!0,this.game=!1}return t.prototype.reset=function(){this.running=!0,dt.play(),ct.stop(),this.game=!0,this.info=!1},t.prototype.update=function(){if(!this.running)return!1;if(!this.info&&0!=g().x&&performance.now()-si>200&&(this.game=!this.game,si=performance.now()),X){if(X=!1,this.game)return this.running=!1,dt.stop(),ct.play(),!0;this.info=!this.info}return this.backgroundTransition.check()&&(this.currentColor=this.nextColor,this.nextColor=s("#",ri)),this.running},t.prototype.draw=function(){var t=this;h("#000000",1),h(this.currentColor,1-this.backgroundTransition.fraction),h(this.nextColor,this.backgroundTransition.fraction);var i=.1+1.8*Math.abs(G%3/3-.5);o("#CCCCCC",i);this.info?(this.room.draw(),R(),K("#999999"),Q(6),$("^ LIFE",.125,.1),$("AUDIO ^",.85,.1),P.textAlign="left",$("MOVE:     wasd / zqsd / arrows /",.219,.26),$("left analogue (Xbox 360)",.39,.3),$("CANNON:     mouse click /",.17,.38),$("right analogue (Xbox 360)",.39,.42),$("MAP/CONFIRM:     spacebar / A (Xbox 360) /",.07,.5),$("pause (Xbox 360)",.39,.54),P.textAlign="center",$("Benjamin Hanken ( @lucentbeam_ )",.5,.76),$("js13k 2017",.5,.83),P.globalAlpha=i,Q(3),$("[ CONFIRM TO CONTINUE ]",.5,.9),P.globalAlpha=1,K("#CCCCCC"),Q(12),$("- CONTROLS -",.5,.18),$("- CREDITS -",.5,.68)):(tt(i,function(){e(At[1],8,11.5)}),e(At[0],2.5,8.6,!0),tt(Math.max(i-.1,0),function(){e(At[2],8,13.8),e(At[2],11.8,14.1),e(At[3],1.5,11.1),e(At[3],4.2,13.1),P.save(),P.scale(-1,1),e(At[3],-16.8,13.3),e(At[3],-19.2,11.6),P.restore(),[[22,65],[26,64],[40,63],[44,62],[85,57],[90,57],[113,63],[117,64],[131,72],[136,74]].forEach(function(t){return n(t[0],t[1])}),t.game&&(K("#999999"),Q(3),$("COLLECT ALL ARTIFACTS",.35,.45))}),K("#CCCCCC"),Q(16),$("- TRAPPED -",.5,.12),Q(11),$("HYPERDIMENSIONAL MAZE",.5,.2825),$("PLAY",.35,.9),$("INFO",.75,.9),Q(8),K("#777777"),$("IN THE",.5,.195),f(s("#","ABCDEF"),4+(this.game?0:8),17.5,.45)),ni.draw(),oi.draw()},t}()),Lt=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),hi=[new Qt],fi=0;W("mousedown",function(t){return++fi}),W("mouseup",function(t){return--fi});var ci=function(t){function i(){var i=t.call(this)||this;return i.laserTo=[new Yt(i.x,i.y,i.x,i.y)],i.lastLaser={x:0,y:0},i.nextLaser={x:0,y:0},i.currentLaserStep=0,i._moving=!1,i.stunTi=new nt(0,.05,.05,!1),i.lifeMax=5,i.hasShield=!1,i.shieldSteps=0,i.hasCannon=!1,i.usingGamepad=!1,i.reset(),W("mousemove",function(t){i.usingGamepad=!1;var e=F.getBoundingClientRect();i.nextLaser.x=(t.clientX-e.left)/e.width*I,i.nextLaser.y=(t.clientY-e.top)/e.width*I,i.lastLaser.x=i.laserTo[0].x2,i.lastLaser.y=i.laserTo[0].y2,i.currentLaserStep=0}),i}return Lt(i,t),Object.defineProperty(i.prototype,"lasing",{get:function(){return fi>0||0!=Nt.right.x||0!=Nt.right.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"life",{get:function(){return this._life},set:function(t){this._life=Math.min(Math.max(t,0),this.lifeMax)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shieldCharged",{get:function(){return this.shieldSteps>50},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"moving",{set:function(t){t&&!this._moving&&(this.moveTime=performance.now()),this._moving=t},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this.stunTi.duration=0,this.hasCannon=!1,this.hasShield=!1,this.shieldSteps=0,this.life=this.lifeMax},i.prototype.onOutOfBounds=function(t){ii.transition(t)},i.prototype.updateGamepad=function(){0==Nt.right.x&&0==Nt.right.y||(this.usingGamepad=!0,this.nextLaser.x=this.x+Nt.right.x*I/2,this.nextLaser.y=this.y+Nt.right.y*I/2,this.lastLaser.x=this.laserTo[0].x2,this.lastLaser.y=this.laserTo[0].y2,this.currentLaserStep=0)},i.prototype.update=function(){this.stunTi.check()?(this.velocity=g(.1/H),this.moving=0!=this.velocity.x||0!=this.velocity.y):this.moving=!1;var t=[this.x,this.y];this.tryMove(this.velocity.x,this.velocity.y);var i=M(this.x-t[0],this.y-t[1]);if(this.hasShield){var e=this.shieldCharged;this.shieldSteps+=i,!e&&this.shieldCharged&&u()}ii.activeRoom.touchesIt(this),this.currentLaserStep=Math.min(this.currentLaserStep+1,H);var n=this.currentLaserStep/H/(this.usingGamepad?4:1);this.laserTo=[new Yt(this.x,this.y,this.lastLaser.x*(1-n)+this.nextLaser.x*n,this.lastLaser.y*(1-n)+this.nextLaser.y*n)],this.laserTo[0]=this.laserTo[0].capped(I/2),this.hasCannon&&(this.laserTo.push(this.laserTo[0].rot90()),this.laserTo.push(this.laserTo[0].rot180()),this.laserTo.push(this.laserTo[0].rot270()))},i.prototype.draw=function(){P.globalCompositeOperation="source-over",P.lineWidth=1+Math.random()*Math.random()*20,this.lasing&&(P.strokeStyle=s("#"),this.laserTo.forEach(function(t){P.beginPath(),P.moveTo(t.x1*S,t.y1*S),P.lineTo(t.x2*S,t.y2*S),P.stroke()})),this.hasShield&&this.shieldCharged&&(P.strokeStyle=o(ui,.7+.3*Math.random()),P.lineWidth=3+Math.random()*Math.random()*8,P.beginPath(),P.arc(this.x*S,this.y*S,this.width*S*1.5,0,2*Math.PI),P.stroke()),e(this._moving?(performance.now()-this.moveTime)%500<250?Mt[1]:Mt[2]:Mt[0],this.x-.5,this.y-.5,!0)},i.prototype.onHitPlayer=function(t){this.hasShield&&this.shieldCharged?this.shieldSteps=0:(this.velocity=t.direction,this.speed=.4/H,this.stunTi.reset(),this.life--,wt())},i}(Ut),di=new ci,ui=s("#","89abcd");ii.onTransitionEnd=function(t,i){var e=i?1.5:.5;hi.forEach(function(i){di.x=i.x=[I/2,e,I/2,I-e][t],di.y=i.y=[I-e,I/2,e,I/2][t];var n=.8+.4*Math.random();i.velocity.x=[Y([-1,1])*n,.5,Y([-1,1])*n,-.5][t]/2,i.velocity.y=[-.5,Y([-1,1])*n,.5,Y([-1,1])*n][t]/2})},A=function(){hi.push(new Qt),hi[1].x=hi[0].x,hi[1].y=hi[1].y,hi.forEach(function(t){t.width/=2,t.maxSpeed*=1.8})},_();